#{extends 'main-text.html' /}
#{knockout /}
#{stylesheet 'admin.css' /}
#{set title:'Admin Panel' /}

<h1>Admin Panel</h1>
<h3>Comics</h3>
<div class="comic-hill">
%{for (comic in comics) { }%
<div class="comic">
	<a href="@{Admin.editComic(comic.label)}">
		<img class="banner" src="/img/banner/${comic.label}.png"">
	</a>
	<span class="title">${comic.title}</span>
	<span class="author">${comic.author}</span>
	<div class="unread-count">Total ${comic.numStrips}</div>
	%{ if (rssFeeds.containsKey(comic.id)) {
		if (rssFeeds.get(comic.id).enabled) { }%<div class="rss-icon has-rss"></div>%{ } else { }%<div class="rss-icon no-rss"></div>%{ } } }%
</div>
%{ } }%
</div>
<br/>
<h3>Jobs</h3>
<table style="text-align: center;">
<tr>
	<th width="120px">Job Name</th>
	<th width="182px">Health</th>
	<th width="182px">Execution Time</th>
	<th width="425x">Last Message</th>
</tr>
<tr>
	<td>Bootstrap<br/><a href="@{Admin.doBootstrap}">run now</a></td>
	<td>#{jobResultGraph results: results.get(0), params: [["count_ok", "green"], ["count_bad", "red"]] /}</td>
	<td>#{jobResultGraph results: results.get(0), params: [["runtime", "blue"]] /}</td>
	<td style="text-align: left; overflow: auto">%{ if (results.get(0).size() > 0) { print results.get(0).get(0).message.nl2br(); } else { print "-"; } }%</td>
</tr>
<tr>
	<td>Comic Cacher<br/><a href="@{Admin.doComicCacher}">run now</a></td>
	<td>#{jobResultGraph results: results.get(1), params: [["count_ok", "green"], ["count_bad", "red"]] /}</td>
	<td>#{jobResultGraph results: results.get(1), params: [["runtime", "blue"]] /}</td>
	<td style="text-align: left; overflow: auto">%{ if (results.get(1).size() > 0) { print results.get(1).get(0).message.nl2br(); } else { print "-"; } }%</td>
</tr>
<tr>
	<td>Tag Builder<br/><a href="@{Admin.doTagBuilder}">run now</a></td>
	<td>#{jobResultGraph results: results.get(2), params: [["count_ok", "green"], ["count_bad", "red"]] /}</td>
	<td>#{jobResultGraph results: results.get(2), params: [["runtime", "blue"]] /}</td>
	<td style="text-align: left; overflow: auto">%{ if (results.get(2).size() > 0) { print results.get(2).get(0).message.nl2br(); } else { print "-"; } }%</td>
</tr>
<tr>
	<td>RSS Updater<br/><a href="@{Admin.doUpdates}">run now</a></td>
	<td>#{jobResultGraph results: results.get(3), params: [["count_ok", "green"], ["count_bad", "red"]] /}</td>
	<td>#{jobResultGraph results: results.get(3), params: [["runtime", "blue"]] /}</td>
	<td style="text-align: left; overflow: auto">%{ if (results.get(3).size() > 0) { print results.get(3).get(0).message.nl2br(); } else { print "-"; } }%</td>
</tr>
<tr>
	<td>Judgement<br/><a href="@{Admin.doJudgement}">run now</a></td>
	<td>#{jobResultGraph results: results.get(4), params: [["count_ok", "green"], ["count_bad", "red"]] /}</td>
	<td>#{jobResultGraph results: results.get(4), params: [["runtime", "blue"]] /}</td>
	<td style="text-align: left; overflow: auto">%{ if (results.get(4).size() > 0) { print results.get(4).get(0).message.nl2br(); } else { print "-"; } }%</td>
</tr>

</table>